<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indelible Data Cyber Essentials Test Files</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul ul {
      margin-left: 20px;
    }
    a {
      text-decoration: none;
      color: #0366d6;
    }
    #fileList .card a {
      display: flex;
      justify-content: space-between;
    }
    header, footer {
      background-color: #3d307a;
      color: #fff;
    }
    header a, footer a {
      color: #fff;
    }
    header a:hover, footer a:hover {
      color: #fff;
    }
    footer p {
      margin-bottom: 0;
    }
    .card-body.download {
      display: flex;
      justify-content: space-between;
      flex-direction: row-reverse;
    }
    .icon {
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }
  </style>
</head>
<body class="d-flex flex-column h-100">
  <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
    <a href="/" class="mb-3 mb-md-0 text-decoration-none text-center">
      <span class="fs-4">Indelible Data Cyber Essentials Test Files</span>
    </a>
  </header>
  <div class="container flex-shrink-0">
    <div class="row">
      <div class="col-12">
        <ul id="fileList"></ul>
        <script>
          const blacklist = ['.github'];
          const username = 'indelibledata';
          const repo = 'Indelible-Data-Test-Files';
          let globalData;  // To hold the full directory structure
          let currentPath = [];  // To keep track of the navigation path

          function isBlacklisted(name) {
            return blacklist.includes(name);
          }

          async function getRepoFiles() {
            try {
              const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/fileList.json?ref=main`;
              const response = await fetch(apiUrl);
              const jsonFile = await response.json();

              if (response.ok) {
                const fileDataUrl = jsonFile.download_url;
                const fileResponse = await fetch(fileDataUrl);
                globalData = await fileResponse.json();
                displayFileList(globalData, currentPath);
              } else {
                alert(`Error: ${jsonFile.message}`);
              }
            } catch (error) {
              alert(`Error: ${error.message}`);
            }
          }

          function displayFileList(data, path) {
            const fileListElement = document.getElementById('fileList');
            fileListElement.innerHTML = '';

            // Display a 'Back' button if not at root
            if (path.length > 0) {
              const liBack = document.createElement('li');
              liBack.innerHTML = `
                <a href="#" onclick="event.preventDefault(); goUpOneLevel();">
                  <div class="card">
                    <div class="card-body directory">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
                      </svg>
                      <span>..</span>
                    </div>
                  </div>
                </a>
              `;
              fileListElement.appendChild(liBack);
            }

            const currentData = path.reduce((acc, curr) => acc.files.find(x => x.name === curr), data);

            currentData.files.forEach(item => {
              const li = document.createElement('li');
              if (!isBlacklisted(item.name)) {
                if (item.type === 'file') {
                  li.innerHTML = `
                    <a href="${item.download_url}" download="${item.name}">
                      <div class="card">
                        <div class="card-body download">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                            <path d="M12 16l4-4h-3V4h-2v8H8z"/><path d="M20 18H4v2h16z"/>
                          </svg>
                          <span>${item.name}</span>
                        </div>
                      </div>
                    </a>
                  `;
                } else if (item.type === 'dir') {
                  li.innerHTML = `
                    <a href="#" onclick="event.preventDefault(); navigateInto('${item.name}');">
                      <div class="card">
                        <div class="card-body directory">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 256 256">
                            <path d="M213.1 82.7l-26.6-40A12.1 12.1 0 0 0 176 36H80a20.1 20.1 0 0 0-20 20v144a20.1 20.1 0 0 0 20 20h144a20.1 20.1 0 0 0 20-20V96a12.1 12.1 0 0 0-4.9-9.3zM80 52h92l18 27H80Z"></path>
                          </svg>
                          <span>${item.name}</span>
                        </div>
                      </div>
                    </a>
                  `;
                }
                fileListElement.appendChild(li);
              }
            });
          }

          function navigateInto(dirName) {
            currentPath.push(dirName);
            displayFileList(globalData, currentPath);
          }

          function goUpOneLevel() {
            currentPath.pop();
            displayFileList(globalData, currentPath);
          }

          getRepoFiles();
        </script>
      </div>
    </div>
  </div>
  <footer class="footer position-absolute bottom-0 w-100 py-3">
    <div class="container">
      <p>&copy; 2024 <a href="https://www.linkedin.com/company/indelible-data-limited/" rel="me" target="_blank">Indelible Data</a></p>
    </div>
  </footer>
</body>
</html>
